<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONE PIECE CARD GAME</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="main-container">
        <!-- Carte Giocatore 1 -->
        <div class="giocatore1">
            <div class="card" draggable="true" id="rufy" onclick="selectCard('rufy')">
                <div id="categoria">Paramisha</div>
                <div id="hp">150<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>CONQUERER</button>
                </div>
                <div class="mosse">
                    <span><button disabled>GOMU-GOMU NO ROCKET</button> 30</span>
                </div>
                <span>Rufy</span>
                <div id="area">
                    <span>Villaggio Fosha</span>
                </div>
            </div>

            <div class="card" draggable="true" id="zoro" onclick="selectCard('zoro')">
                <div id="categoria">Normale</div>
                <div id="hp">180<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>OBSERVATION</button>
                </div>
                <div class="mosse">
                    <span><button disabled>TECNICA A UNA SPADA</button> 20</span>
                </div>
                <span>Zoro</span>
                <div id="area">
                    <span>none</span>
                </div>
            </div>

            <div class="card" draggable="true" id="sanji" onclick="selectCard('sanji')">
                <div id="categoria">Normale</div>
                <div id="hp">140<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>DIABLE JUMP</button> 40</span>
                </div>
                <span>Sanji</span>
                <div id="area">
                    <span>Baratie</span>
                </div>
            </div>

            <div class="card" draggable="true" id="robin" onclick="selectCard('robin')">
                <div id="categoria">Paramisha</div>
                <div id="hp">120<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>OBSERVATION</button>
                </div>
                <div class="mosse">
                    <span><button disabled>GIGANTESCO MANO</button> 50</span>
                </div>
                <span>Robin</span>
                <div id="area">
                    <span>Ohara</span>
                </div>
            </div>

            <div class="card" draggable="true" id="chopper" onclick="selectCard('chopper')">
                <div id="categoria">Zoan</div>
                <div id="hp">80<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>RUMBLE CANDY</button> 30</span>
                </div>
                <span>Chopper</span>
                <div id="area">
                    <span>Regno dei ciliegi</span>
                </div>
            </div>

            <div class="card" draggable="true" id="jinbe" onclick="selectCard('jinbe')">
                <div id="categoria">Uomo-Pesce</div>
                <div id="hp">160<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>TECNICA SEGRETA</button> 50</span>
                </div>
                <span>Jinbe</span>
                <div id="area">
                    <span>Isola degli Uomini-Pesce</span>
                </div>
            </div>

        </div>

        <!-- Mappa -->
        <div class="mappa">
            <button id="inizia-lancio">INIZIA PARTITA!</button>

            <div class="turn-info">
                Turno: <span id="turno">Giocatore 1</span>
            </div>
            <button id="termina-turno-giocatore1">Termina Turno</button>

            <!-- Nave Giocatore 1 -->
            <div class="nave-giocatore1">
                <span class="ship-name">Going Merry</span>
            </div>

            <div class="isole">
                <div class="isola">
                    <span class="isola-span">Dressrosa</span>
                </div>
                <div class="isola">
                    <span class="isola-span">Alabasta</span>
                </div>
                <div class="isola">
                    <span class="isola-span">Punk Hazard</span>
                </div>
                <div class="isola">
                    <span class="isola-span">Arlong Park</span>
                </div>
                <div class="isola">
                    <span class="isola-span">Baratie</span>
                </div>
            </div>

            <div class="turn-info">
                Turno: <span id="turno2">Giocatore 1</span>
            </div>
            <button id="termina-turno-giocatore2">Termina Turno</button>
            
            <!-- Nave Giocatore 2 -->
            <div class="nave-giocatore2">
                <span class="ship-name">Nave della Marina</span>
            </div>
        </div>

        <!-- Carte Giocatore 2 -->
        <div class="giocatore2">
            <div class="card" draggable="true" id="crocodile" onclick="selectCard('crocodile')">
                <div id="categoria">Rogia</div>
                <div id="hp">130<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>DESERTO SPADA</button> 30</span>
                </div>
                <span>Crocodile</span>
                <div id="area">
                    <span>Alabasta</span>
                </div>
            </div>

            <div class="card" draggable="true" id="smoker" onclick="selectCard('smoker')">
                <div id="categoria">Rogia</div>
                <div id="hp">160<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>WHITE SMOKE</button> 30</span>
                </div>
                <span>Smoker</span>
                <div id="area">
                    <span>Lougue Town</span>
                </div>
            </div>

            <div class="card" draggable="true" id="arlong" onclick="selectCard('arlong')">
                <div id="categoria">Uomo-Pesce</div>
                <div id="hp">130<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>SPEZZACOLLO</button> 50</span>
                </div>
                <span>Arlong</span>
                <div id="area">
                    <span>Arlong Park</span>
                </div>
            </div>

            <div class="card" draggable="true" id="mihawk" onclick="selectCard('mihawk')">
                <div id="categoria">Normale</div>
                <div id="hp">170<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>OBSERVATION</button>
                </div>
                <div class="mosse">
                    <span><button disabled>COLTELLO</button> 10</span>
                </div>
                <span>Mihawk</span>
                <div id="area">
                    <span>Baratie</span>
                </div>
            </div>

            <div class="card" draggable="true" id="bugy" onclick="selectCard('bugy')">
                <div id="categoria">Paramisha</div>
                <div id="hp">120<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>CONQUERER</button>
                </div>
                <div class="mosse">
                    <span><button disabled>BUGY BALL</button> 40</span>
                </div>
                <span>Bugy</span>
                <div id="area">
                    <span>none</span>
                </div>
            </div>

            <div class="card" draggable="true" id="alvida" onclick="selectCard('alvida')">
                <div id="categoria">Paramisha</div>
                <div id="hp">100<span> HP</span></div>
                <div id="haki">
                    <span>Haki:</span>
                    <button disabled>ARMOR</button>
                </div>
                <div class="mosse">
                    <span><button disabled>ALVIDA BALL</button> 20</span>
                </div>
                <span>Alvida</span>
                <div id="area">
                    <span>none</span>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Funzione per applicare l'immagine di sfondo in base all'id
        function setCardBackground(cardId, imagePath) {
            const card = document.getElementById(cardId);
            if (card) {
                card.style.backgroundImage = `url('${imagePath}')`;
                card.style.backgroundSize = 'cover'; // Copre tutta la card
            }
        }

        // Esegui il settaggio degli sfondi per ogni carta
        window.onload = function () {
            setCardBackground('rufy', 'images/Rufy.png');
            setCardBackground('zoro', 'images/Zoro.png');
            setCardBackground('sanji', 'images/Sanji.jpg');
            setCardBackground('robin', 'images/Robin.jpg');
            setCardBackground('chopper', 'images/Chopper.png');
            setCardBackground('jinbe', 'images/Jinbe.png');
            setCardBackground('crocodile', 'images/Crocodile.png');
            setCardBackground('smoker', 'images/Smoker.png');
            setCardBackground('arlong', 'images/Arlong.png');
            setCardBackground('bugy', 'images/Bugy.png');
            setCardBackground('mihawk', 'images/Mihawk.png');
            setCardBackground('alvida', 'images/Alvida.png');
        };

        let selectedCard = null; // Aggiungi questa dichiarazione all'inizio dello script

        function selectCard(cardId) {
            // Se c'è già una carta selezionata, deselezioniamola
            if (selectedCard) {
                deselectCard();
            }

            // Seleziona la nuova carta
            selectedCard = document.getElementById(cardId);
            if (selectedCard) {
                selectedCard.classList.add('selected'); // Aggiunge lo stile di selezione
                const buttons = selectedCard.querySelectorAll('button');
                buttons.forEach(button => (button.disabled = false)); // Abilita i pulsanti
            }

            // Aggiunge un event listener per rilevare clic fuori dalla carta
            document.addEventListener('click', handleOutsideClick);
        }

        function deselectCard() {
    if (selectedCard) {
        selectedCard.classList.remove('selected'); // Rimuove lo stile di selezione
        const buttons = selectedCard.querySelectorAll('button');
        buttons.forEach(button => (button.disabled = true)); // Disabilita i pulsanti
        selectedCard = null; // Resetta la carta selezionata
    }

    // Rimuove l'event listener per clic fuori dalla carta
    document.removeEventListener('click', handleOutsideClick);
}

function handleOutsideClick(event) {
    if (!selectedCard.contains(event.target)) {
        deselectCard();
    }
}

        // Seleziona tutte le carte
        const cards = document.querySelectorAll('.card');

        cards.forEach(card => {
            // Aggiungi un evento di clic alla carta
            card.addEventListener('click', function (e) {
                // Se la carta non è già selezionata
                if (!card.classList.contains('selected')) {
                    // Rimuovi la classe selected da tutte le carte
                    cards.forEach(c => {
                        c.classList.remove('selected');
                        // Disattiva i bottoni
                        const buttons = c.querySelectorAll('button');
                        buttons.forEach(button => button.disabled = true);
                    });
                    // Aggiungi la classe selected alla carta cliccata
                    card.classList.add('selected');
                    // Attiva i bottoni
                    const buttons = card.querySelectorAll('button');
                    buttons.forEach(button => button.disabled = false);
                }
                e.stopPropagation(); // Impedisce che il clic si propaghi al documento
            });

            // Seleziona tutti i bottoni all'interno della carta
            const buttons = card.querySelectorAll('button');
            buttons.forEach(button => {
                // Aggiungi un evento di clic al bottone
                button.addEventListener('click', function (e) {
                    // Rimuovi la classe selected dalla carta
                    card.classList.remove('selected');
                    // Disattiva i bottoni
                    buttons.forEach(btn => btn.disabled = true);
                    e.stopPropagation(); // Impedisce che il clic si propaghi al documento
                });
            });
        });

        // Rimuovi la selezione cliccando fuori dalla carta
        document.addEventListener('click', () => {
            cards.forEach(card => {
                card.classList.remove('selected');
                // Disattiva i bottoni
                const buttons = card.querySelectorAll('button');
                buttons.forEach(button => button.disabled = true);
            });
        });
    </script>

    <script src="js/Card.js"></script>
    <script src="js/Turn.js"></script>
</body>

</html>