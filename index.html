<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONE PIECE CARD GAME</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="main-container">
        <!-- Carte Giocatore 1 -->
        <div class="giocatore1">
            <div class="card carta-giocatore1" draggable="true" id="rufy" onclick="selectCard('rufy')">
                <div class="header">
                    <div id="categoria">Paramisha</div>
                    <div id="hp">150<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>CONQUERER</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('rufy', 'GOMU-GOMU NO ROCKET')" class="useMove">GOMU-GOMU NO
                                ROCKET</button>
                            <div class="danno"> 30</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Rufy</span>
                    <div id="area">
                        <span>Villaggio Fosha</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore1" draggable="true" id="zoro" onclick="selectCard('zoro')">
                <div class="header">
                    <div id="categoria">Normale</div>
                    <div id="hp">180<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>OBSERVATION</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('zoro', 'TECNICA A UNA SPADA')" class="useMove">TECNICA A UNA
                                SPADA</button>
                            <div class="danno"> 20</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Zoro</span>
                    <div id="area">
                        <span>Marineford</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore1" draggable="true" id="sanji" onclick="selectCard('sanji')">
                <div class="header">
                    <div id="categoria">Normale</div>
                    <div id="hp">140<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('sanji', 'DIABLE JUMP')" class="useMove">DIABLE JUMP</button>
                            <div class="danno"> 40</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Sanji</span>
                    <div id="area">
                        <span>Baratie</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore1" draggable="true" id="robin" onclick="selectCard('robin')">
                <div class="header">
                    <div id="categoria">Paramisha</div>
                    <div id="hp">120<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>OBSERVATION</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('robin', 'GIGANTESCO MANO')" class="useMove">GIGANTESCO
                                MANO</button>
                            <div class="danno"> 50</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Robin</span>
                    <div id="area">
                        <span>Ohara</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore1" draggable="true" id="chopper" onclick="selectCard('chopper')">
                <div class="header">
                    <div id="categoria">Zoan</div>
                    <div id="hp">80<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('chopper', 'RUMBLE CANDY')" class="useMove">RUMBLE CANDY</button>
                            <div class="danno"> 30</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Chopper</span>
                    <div id="area">
                        <span>Regno dei ciliegi</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore1" draggable="true" id="jinbe" onclick="selectCard('jinbe')">
                <div class="header">
                    <div id="categoria">Uomo-Pesce</div>
                    <div id="hp">160<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('jinbe', 'TECNICA SEGRETA')" class="useMove">TECNICA
                                SEGRETA</button>
                            <div class="danno"> 40</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Jinbe</span>
                    <div id="area">
                        <span>Isola degli Uomini-Pesce</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Mappa -->
        <div class="mappa" id="mappa">
            <button id="inizia-lancio" class="mappa-button">INIZIA PARTITA!</button>

            <div class="turn-info">
                Turno: <span id="turno">Giocatore 1</span>
            </div>
            <button id="termina-turno-giocatore1" class="termina-turno mappa-button" disabled>Termina Turno</button>

            <!-- Nave Giocatore 1 -->
            <div class="nave-giocatore1" id="going-merry">
                <span class="ship-name">Going Merry</span>
            </div>

            <div class="isole">
                <div class="isola" id="Dressrosa">
                    <span class="isola-span">Dressrosa</span>
                </div>
                <div class="isola" id="Alabasta">
                    <span class="isola-span">Alabasta</span>
                </div>
                <div class="isola" id="Arlong-park">
                    <span class="isola-span">Arlong Park</span>
                </div>
                <div class="isola" id="Baratie">
                    <span class="isola-span">Baratie</span>
                </div>
            </div>

            <div class="turn-info">
                Turno: <span id="turno2">Giocatore 1</span>
            </div>
            <button id="termina-turno-giocatore2" class="termina-turno mappa-button" disabled>Termina Turno</button>

            <!-- Nave Giocatore 2 -->
            <div class="nave-giocatore2" id="marine">
                <span class="ship-name">Nave della Marina</span>
            </div>
        </div>

        <!-- Carte Giocatore 2 -->
        <div class="giocatore2">
            <div class="card carta-giocatore2" draggable="true" id="crocodile" onclick="selectCard('crocodile')">
                <div class="header">
                    <div id="categoria">Rogia</div>
                    <div id="hp">130<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('crocodile', 'DESERTO SPADA')" class="useMove">DESERTO
                                SPADA</button>
                            <div class="danno"> 30</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Crocodile</span>
                    <div id="area">
                        <span>Alabasta</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore2" draggable="true" id="smoker" onclick="selectCard('smoker')">
                <div class="header">
                    <div id="categoria">Rogia</div>
                    <div id="hp">160<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('smoker', 'WHITE SMOKE')" class="useMove">WHITE SMOKE</button>
                            <div class="danno"> 30</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Smoker</span>
                    <div id="area">
                        <span>Lougue Town</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore2" draggable="true" id="arlong" onclick="selectCard('arlong')">
                <div class="header">
                    <div id="categoria">Uomo-Pesce</div>
                    <div id="hp">130<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('arlong', 'SPEZZACOLLO')" class="useMove">SPEZZACOLLO</button>
                            <div class="danno"> 50</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Arlong</span>
                    <div id="area">
                        <span>Arlong Park</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore2" draggable="true" id="mihawk" onclick="selectCard('mihawk')">
                <div class="header">
                    <div id="categoria">Normale</div>
                    <div id="hp">170<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>OBSERVATION</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('mihawk', 'COLTELLO')" class="useMove">COLTELLO</button>
                            <div class="danno"> 10</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Mihawk</span>
                    <div id="area">
                        <span>Baratie</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore2" draggable="true" id="bugy" onclick="selectCard('bugy')">
                <div class="header">
                    <div id="categoria">Paramisha</div>
                    <div id="hp">120<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>CONQUERER</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('bugy', 'BUGY BALL')" class="useMove">BUGY BALL</button>
                            <div class="danno"> 40</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Bugy</span>
                    <div id="area">
                        <span>Logue Town</span>
                    </div>
                </div>
            </div>

            <div class="card carta-giocatore2" draggable="true" id="alvida" onclick="selectCard('alvida')">
                <div class="header">
                    <div id="categoria">Paramisha</div>
                    <div id="hp">100<span> HP</span></div>
                </div>
                <div class="main">
                    <div id="haki">
                        <span>Haki:</span>
                        <button disabled>ARMOR</button>
                    </div>
                    <div class="mosse">
                        <span>
                            <button onclick="useMove('alvida', 'ALVIDA BALL')" class="useMove">ALVIDA BALL</button>
                            <div class="danno"> 20</div>
                        </span>
                    </div>
                </div>
                <div class="footer">
                    <span class="pg-name">Alvida</span>
                    <div id="area">
                        <span>Baratie</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Funzione per applicare l'immagine di sfondo in base all'id
        function setCardBackground(cardId, imagePath) {
            const card = document.getElementById(cardId);
            if (card) {
                card.style.backgroundImage = `url('${imagePath}')`;
                card.style.backgroundSize = 'cover'; // Copre tutta la card
            }
        }

        // Esegui il settaggio degli sfondi per ogni carta
        window.onload = function () {
            setCardBackground('rufy', 'images/Rufy.png');
            setCardBackground('zoro', 'images/Zoro.png');
            setCardBackground('sanji', 'images/Sanji.jpg');
            setCardBackground('robin', 'images/Robin.jpg');
            setCardBackground('chopper', 'images/Chopper.png');
            setCardBackground('jinbe', 'images/Jinbe.png');
            setCardBackground('crocodile', 'images/Crocodile.png');
            setCardBackground('smoker', 'images/Smoker.png');
            setCardBackground('arlong', 'images/Arlong.png');
            setCardBackground('bugy', 'images/Bugy.png');
            setCardBackground('mihawk', 'images/Mihawk.png');
            setCardBackground('alvida', 'images/Alvida.png');
            setCardBackground('Dressrosa', 'images/dressrosa.png');
            setCardBackground('Alabasta', 'images/alabasta.jpg');
            setCardBackground('Baratie', 'images/baratie.png');
            setCardBackground('Arlong-park', 'images/arlong-park.png');
            setCardBackground('mappa', 'images/mappa.jpg');
            setCardBackground('marine', 'images/marine.jpg');
            setCardBackground('going-merry', 'images/going-merry.png');

            const isolaElement = document.getElementById('isola');
            if (isolaElement) {
                isolaElement.classList.add('oggetto-style');
            }

            const mappaElement = document.getElementById('mappa');
            if (mappaElement) {
                mappaElement.classList.add('oggetto-style');
            }

            const nave1Element = document.getElementById('going-merry');
            const nave2Element = document.getElementById('marine');
            if (nave1Element && nave2Element) {
                nave1Element.classList.add('oggetto-style');
                nave2Element.classList.add('oggetto-style');
            }
        };

        let selectedCard = null; // Aggiungi questa dichiarazione all'inizio dello script

        function selectCard(cardId) {
            // Se c'è già una carta selezionata, deselezioniamola
            if (selectedCard) {
                deselectCard();
            }

            // Seleziona la nuova carta
            selectedCard = document.getElementById(cardId);
            if (selectedCard) {
                selectedCard.classList.add('selected'); // Aggiunge lo stile di selezione
                const buttons = selectedCard.querySelectorAll('button');
                buttons.forEach(button => (button.disabled = false)); // Abilita i pulsanti
            }

            // Aggiunge un event listener per rilevare clic fuori dalla carta
            document.addEventListener('click', handleOutsideClick);
        }

        function deselectCard() {
            if (selectedCard) {
                selectedCard.classList.remove('selected'); // Rimuove lo stile di selezione
                const buttons = selectedCard.querySelectorAll('button');
                buttons.forEach(button => (button.disabled = true)); // Disabilita i pulsanti
                selectedCard = null; // Resetta la carta selezionata
            }

            // Rimuove l'event listener per clic fuori dalla carta
            document.removeEventListener('click', handleOutsideClick);
        }

        function handleOutsideClick(event) {
            if (!selectedCard.contains(event.target)) {
                deselectCard();
            }
        }

        // Seleziona tutte le carte
        const cards = document.querySelectorAll('.card');

        cards.forEach(card => {
            // Aggiungi un evento di clic alla carta
            card.addEventListener('click', function (e) {
                // Se la carta non è già selezionata
                if (!card.classList.contains('selected')) {
                    // Rimuovi la classe selected da tutte le carte
                    cards.forEach(c => {
                        c.classList.remove('selected');
                        // Disattiva i bottoni
                        const buttons = c.querySelectorAll('button');
                        buttons.forEach(button => button.disabled = true);
                    });
                    // Aggiungi la classe selected alla carta cliccata
                    card.classList.add('selected');
                    // Attiva i bottoni
                    const buttons = card.querySelectorAll('button');
                    buttons.forEach(button => button.disabled = false);
                }
                e.stopPropagation(); // Impedisce che il clic si propaghi al documento
            });

            // Seleziona tutti i bottoni all'interno della carta
            const buttons = card.querySelectorAll('button');
            buttons.forEach(button => {
                // Aggiungi un evento di clic al bottone
                button.addEventListener('click', function (e) {
                    // Rimuovi la classe selected dalla carta
                    card.classList.remove('selected');
                    // Disattiva i bottoni
                    buttons.forEach(btn => btn.disabled = true);
                    e.stopPropagation(); // Impedisce che il clic si propaghi al documento
                });
            });
        });

        // Rimuovi la selezione cliccando fuori dalla carta
        document.addEventListener('click', () => {
            cards.forEach(card => {
                card.classList.remove('selected');
                // Disattiva i bottoni
                const buttons = card.querySelectorAll('button');
                buttons.forEach(button => button.disabled = true);
            });
        });
    </script>

    <script src="js/Card.js"></script>
    <script src="js/Battle.js"></script>
    <script src="js/Turn.js"></script>
</body>

</html>